#!/bin/env bash

# Source: https://github.com/jfrazelle/dotfiles/blob/master/.dockerfunc

# TODO: set the repo prefix here when using a repository
# export DOCKER_REPO_PREFIX=registry.digitalocean.com/aztlan/

# Helper functions 
dcleanup(){
    docker rm -v $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
    docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}

del_stopped(){
    local name=$1
    local state=$(docker inspect --format "{{.State.Running}}" $name 2>/dev/null)

    if [[ "$state" == "false" ]]; then
        docker rm $name
    fi
}

relies_on(){
    local containers=$@

    for container in $containers; do
        local state=$(docker inspect --format "{{.State.Running}}" $container 2>/dev/null)

        if [[ "$state" == "false" ]] || [[ "$state" == "" ]]; then
            echo "$container is not running, starting it for you."
            $container
        fi
    done
}

# Container aliases
# node() {}

# npm() {}

yarn() {
    docker run -it --rm \
        --name yarn \
        ${DOCKER_REPO_PREFIX}yarn "$@"
}

languagetool() {
    docker run -it --rm \
        --name languagetool
        ${DOCKER_REPO_PREFIX}languagetool "$@"
}
